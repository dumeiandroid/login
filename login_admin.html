<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Access</title>
  <!-- Sembunyikan judul tab agar tidak mencurigakan -->
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --accent: #c8a96e;
      --bg: #080809;
      --card: #0f0f11;
      --border: rgba(200,169,110,0.15);
      --text: #e8e8e8;
      --muted: #555;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    /* Grid background subtle */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(200,169,110,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(200,169,110,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }

    .wrap {
      width: 100%;
      max-width: 380px;
      position: relative;
      z-index: 1;
    }

    .top-label {
      font-size: 0.65rem;
      letter-spacing: 0.25em;
      color: var(--accent);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .card-title {
      font-family: 'Syne', sans-serif;
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: 0.3rem;
    }

    .card-desc {
      font-size: 0.72rem;
      color: var(--muted);
      margin-bottom: 2.2rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem 1.8rem;
    }

    .field {
      margin-bottom: 1.2rem;
    }

    .field label {
      display: block;
      font-size: 0.68rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 0.5rem;
    }

    .field input {
      width: 100%;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.07);
      border-radius: 8px;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .field input:focus {
      border-color: var(--accent);
    }

    .btn {
      width: 100%;
      padding: 0.85rem;
      background: var(--accent);
      color: #080809;
      border: none;
      border-radius: 8px;
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 0.82rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: opacity 0.2s, transform 0.15s;
    }

    .btn:hover   { opacity: 0.9; }
    .btn:active  { transform: scale(0.98); }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .msg {
      margin-top: 1rem;
      padding: 0.65rem 0.9rem;
      border-radius: 7px;
      font-size: 0.78rem;
      display: none;
    }
    .msg.success { background: rgba(100,200,100,0.08); color: #7dda7d; border: 1px solid rgba(100,200,100,0.2); display: block; }
    .msg.error   { background: rgba(220,80,80,0.08);  color: #e87878; border: 1px solid rgba(220,80,80,0.2);  display: block; }

    .footer-note {
      margin-top: 1.5rem;
      font-size: 0.65rem;
      color: var(--muted);
      text-align: center;
      letter-spacing: 0.05em;
    }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="top-label">Restricted Access</div>
    <div class="card-title">Administrator</div>
    <div class="card-desc">// Halaman ini tidak dipublikasikan</div>

    <div class="card">
      <form id="adminForm" onsubmit="handleLogin(event)">
        <div class="field">
          <label>Username</label>
          <input type="text" id="username" placeholder="admin_username" required autocomplete="off"/>
        </div>
        <div class="field">
          <label>Password</label>
          <input type="password" id="password" placeholder="••••••••••••" required autocomplete="off"/>
        </div>
        <button type="submit" class="btn" id="loginBtn">Authenticate</button>
        <div class="msg" id="msg"></div>
      </form>
    </div>

    <div class="footer-note">Akses tidak sah akan dicatat.</div>
  </div>

  <script>
    // ─── KONFIGURASI ──────────────────────────────────────────
    const API_URL       = 'https://lidan-co-id.pages.dev/api/contacts_filter_dinamis7';
    const API_SECRET    = 'admin';                            // ← ganti
    const REDIRECT_URL  = '/admin/dashboard.html';            // ← ganti
    // ──────────────────────────────────────────────────────────

    // Jika sudah login sebagai admin, langsung redirect
    if (localStorage.getItem('auth_role') === 'admin' && localStorage.getItem('auth_token')) {
      window.location.href = REDIRECT_URL;
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const btn      = document.getElementById('loginBtn');
      const msgEl    = document.getElementById('msg');

      msgEl.className = 'msg';
      msgEl.textContent = '';
      btn.disabled = true;
      btn.textContent = 'Verifying...';

      try {
        const res = await fetch(`${API_URL}?action=login`, {
          method: 'POST',
          headers: {
            'Content-Type' : 'application/json',
            'X-Custom-Auth': API_SECRET,
            'X-Role'       : 'admin'          // ← selalu admin
          },
          body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (data.success) {
          localStorage.setItem('auth_token', API_SECRET);
          localStorage.setItem('auth_role',  'admin');
          localStorage.setItem('auth_user',  JSON.stringify(data.data));

          msgEl.className = 'msg success';
          msgEl.textContent = 'Access granted. Redirecting...';

          // Kembali ke halaman asal, kalau tidak ada pakai history.back()
          const redirectBack = localStorage.getItem('auth_redirect_back');
          localStorage.removeItem('auth_redirect_back');

          setTimeout(() => {
            if (redirectBack) {
              window.location.href = redirectBack;
            } else {
              history.back(); // kembali ke halaman sebelumnya
            }
          }, 900);
        } else {
          msgEl.className = 'msg error';
          msgEl.textContent = 'Access denied.';
        }

      } catch (err) {
        msgEl.className = 'msg error';
        msgEl.textContent = 'Connection error.';
      }

      btn.disabled = false;
      btn.textContent = 'Authenticate';
    }
  </script>

</body>
</html>